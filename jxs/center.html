<!DOCTYPE html>
<html>

<head>
    <title>网上讲习所</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!-- head 中 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
    <link href="../css/main.css" rel="stylesheet" />
</head>

<body>
    <div class="nav">
        <span onclick="history.go(-1)">
            <img src="../img/arrow-left.png" />
        </span>
        <span>网上讲习所</span>
        <span id="btn-nav">导航</span>
    </div>
    <div class="weui-skin_android" id="androidActionsheet" style="display:none">
        <div class="weui-mask" style="visibility:visible; opacity:0.5"></div>
        <div class="weui-actionsheet">
            <div class="weui-actionsheet__menu">
                <div class="weui-actionsheet__cell" onclick="navClick('index.html')">信息资讯</div>
                <div class="weui-actionsheet__cell" onclick="navClick('map.html')">党建大数据</div>

                <div class="weui-actionsheet__cell" onclick="navClick('center.html')">网上讲习所</div>
                <div class="weui-actionsheet__cell" onclick="navClick('jianguan.html')">轮战监管</div>

                <div class="weui-actionsheet__cell" onclick="navClick('user.html')">个人信息</div>

            </div>
        </div>
    </div>
    <!-- Swiper -->
    <!-- Swiper -->
    <div class="swiper-container map">

        <div class="swiper-wrapper" id="banners2">

            <div class="swiper-slide" onclick="location.href='detail2.html'">
                <p>
                    1杨景连又学习了《参考消息》
                </p>

            </div>



        </div>
        <img src="../img/map/喇叭001_hover.png" />
    </div>

    <div class="panel study">
        <div class="panel-title index">
            <span>习近平新时代中国特色社会主义</span>

            <a onclick="navClick('indexList.html?type_name=习近平新时代中国特色社会主义&type_id=21')" class="more">查看更多</a>
        </div>

        <div id="articleList" class="weui-cells" style="margin-top:0">

        </div>
    </div>

    <div class="panel study">
        <div class="panel-title index">
            <span>新时代学习大讲堂</span>

            <a onclick="navClick('indexList.html?type_name=新时代学习大讲堂&type_id=21')" class="more">查看更多</a>
        </div>

        <div id="newArticleList" class="weui-cells" style="margin-top:0">

        </div>
    </div>

    <div class="panel study">
        <div class="panel-title">
            <span>我的课程</span>
            <a onclick="navClick('centerMore.html')" class="more">查看更多</a>
        </div>
        <div id="myStudy" class="weui-cells" style="margin-top:0">

            <!--<div class="weui-cell">
                <div class="weui-cell__hd"><img class="item-cover" src="https://api.lpszzb.gov.cn/static/files/20180606141513_屏幕快照 2018-06-06 13.55.21.png"></div>
                <div class="weui-cell__bd"><a href="detail.html?id=4">视频测试02</a></div>
            </div>-->

        </div>
    </div>

    <!--<div class="panel ">
        <div class="panel-title">
            <span>上课提醒</span>
        </div>
        <div class="panel-body">
           <div class="card-alert">
               <div class="alert-title">5.22（周一）<span>13:00-14:30</span></div>
               <div class="alert-body">
                   <div class="item">
                       <img src="../img/kecheng3.png" />
                       <span>课程：党员学习</span>
                   </div>
                   <div class="item">
                       <img src="../img/kecheng31.png" />
                       <span>课程老师：徐怀</span>
                   </div>
                   <div class="item">
                       <img src="../img/kecheng32.png" />
                       <span>上课人数：20人</span>
                   </div>
                   <div class="item">
                       <img src="../img/kecheng33.png" />
                       <span>本期内容：强化思想入党，掌握党，基本知识，提高履行党员义务的素质与能力。</span>
                   </div>
               </div>
           </div>
        </div>


    </div>-->

    <a href="#" class="recommed">

        <div>教学资源</div>
        <!-- <div>
            <img src="../img/search.png" />
        </div> -->
    </a>

    <div class="weui-grids" id="navs">


    </div>

    <div class="panel testing ">
        <div class="panel-title">
            <span>考试中心</span>
            <a onclick="navClick('myTestList.html')" class="more">我的考试</a>
        </div>
        <div id="exam_list"></div>
    </div>
    <!-- body 最后 -->
    <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js" type='text/javascript' charset='utf-8'></script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js" type='text/javascript' charset='utf-8'></script>
    <script src="https://g.alicdn.com/dingding/open-develop/1.9.0/dingtalk.js" type='text/javascript' charset='utf-8'></script>
    <script src="../scripts/swiper.min.js"></script>

    <!-- mustache.js -->
    <script src="https://cdn.bootcss.com/mustache.js/2.3.0/mustache.min.js" type='text/javascript' charset='utf-8'></script>

    <script src="../scripts/main.js"></script>
    <script src="../scripts/examList.js"></script>

    <!-- Initialize Swiper -->
    <script>
        var bgColor = ["#F1514B", "#71AAFA", "#54CED4", "#3BA3F8", "#9FCB87", "#F2A04B", "#54CED4", "#71AAFA", "#F1514B", "#3BA3F8"];
        var listURL = 'studyList.html?type_id={{type_id}}&type_name={{type_name}}&version=' + version;
        var navItemHtml = '<a href="' + listURL +  '" class="weui-grid js_grid">' +
            '<div class="weui-grid__icon" style="background:{{bgcolor}}">' +
            ' <img src="{{type_icon}}" />' +
            ' </div>' +
            ' <p class="weui-grid__label">' +
            '     {{type_name}}' +
            '   </p>' +
            '  </a>';
        var html = '<div class="weui-flex list">{{inner}}</div>';

        var mySwiper = new Swiper('.swiper-container', {
            autoplay: true,//可选选项，自动滑动
        })

        var userInfo = {};
        var url = window.location.href;

        function setUserInfo(info) {
            userInfo = info;
            //我的课程
            var url = "https://api.lpszzb.gov.cn/study?user_id=" + userInfo.emplId + "&limit=3";
            $.get(url, function (rel) {
                genStudyListHtml(rel, 'myStudy')
            });
        }


        var bannerHtml = '<div class="swiper-slide" onclick="goToDetailPage({{id}})">' +

            ' <p>{{user}} 最近学习了 {{title}} </p>' +
            '</div>';

        $(function () {
            getUserInfo(url, setUserInfo);
            //习近平新时代
            var articleListUrl = "https://api.lpszzb.gov.cn/article?type_id=21&limit=3";
            $.get(articleListUrl, function (rel) {
                genArticleHtml(rel, 'articleList')
            });
            //新时代大讲堂
            var newArticleListUrl = "https://api.lpszzb.gov.cn/article?type_id=21&limit=3";
            $.get(newArticleListUrl, function (rel) {
                genArticleHtml(rel, 'newArticleList')
            });
            //教学中心 - 目录
            $.get("https://api.lpszzb.gov.cn/type?type_id=30&status=0&type_state=2", function (rel) {


                var strInner = [];

                for (var i = 0; i < rel.data.length; i++) {

                    strInner.push(navItemHtml
                        .replace("{{type_id}}", rel.data[i].type_id)
                        .myReplace("{{type_name}}", rel.data[i].type_name)
                        .replace("{{type_icon}}", rel.data[i].type_icon)
                        .replace("{{bgcolor}}", bgColor[i])
                    );

                }

                $("#navs").html(strInner.join(""));
            });

            //banners
            $.get("https://api.lpszzb.gov.cn/study?user_id=&limit=3", function (rel) {
                console.log(rel);

                var banners = [];
                var count = rel.rows.length;

                for (var i = 0; i < rel.rows.length; i++) {

                    (function (i) {
                        $.get("https://api.lpszzb.gov.cn/dding?key=user_info&user_id=" + rel.rows[i].user_id, function (user) {

                            console.log(user);


                            banners.push(bannerHtml.replace("{{id}}", rel.rows[i].article_id).replace("{{user}}", user.name).replace("{{title}}", rel.rows[i].article.title));

                            if (banners.length == count) {
                                $("#banners2").html(banners.join(""));
                                var swiper = new Swiper('.swiper-container', {

                                    paginationClickable: true,
                                    speed: 500,
                                    loop: true,
                                    observer: true,
                                    observeParents: true,
                                    autoplayDisableOnInteraction: false,
                                    autoplay: true,

                                });
                            }

                        });

                    })(i);
                }
            });

        });

    </script>
</body>

</html>